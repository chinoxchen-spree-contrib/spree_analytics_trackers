<% if segment_enabled? && @order.present? && !@order.completed? %>
  <script>
    window.addEventListener('turbolinks:load', function() {
      if (typeof analytics !== 'undefined') {
        <% if user = try_spree_current_user %>
          analytics.identify('<%= user.id %>', {
            email: '<%= user.email %>'
          });
        <% else %>
          analytics.identify({});
        <% end %>
        analytics.track('Checkout Step Viewed', {
          checkout_id: '<%= @order.number %>',
          step: '<%= (@order.checkout_steps.index(@order.state) + 1) %>'
        });
        analytics.page('Checkout Step Viewed', {
          checkout_id: '<%= @order.number %>',
          step: '<%= (@order.checkout_steps.index(@order.state) + 1) %>'
        });
      }
    });
  </script>
<% end %>  
