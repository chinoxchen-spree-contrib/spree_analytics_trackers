<% if segment_enabled? && params.key?(:keywords) && params[:keywords].present? %>
<script>
  window.addEventListener('turbolinks:load', function() {
    if (typeof analytics !== 'undefined') {
      <% if user = try_spree_current_user %>
          analytics.identify('<%= user.id %>', {
            email: '<%= user.email %>'
          });
      <% else %>
          analytics.identify({});
      <% end %>
      analytics.track('Products Searched', {
        query: '<%= params[:keywords] %>',
      });
      analytics.page('Products Searched', {
        query: '<%= params[:keywords] %>',
      });
    }
  });
</script>
<% end %>
